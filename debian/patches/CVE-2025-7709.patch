Partial backport of:

From 192d0ff8ccf0bf55776a5930cdc64e25f87299d6 Mon Sep 17 00:00:00 2001
From: dan <Dan Kennedy>
Date: Tue, 15 Jul 2025 14:06:15 +0000
Subject: [PATCH] Optimize allocation of large tombstone arrays in fts5.

FossilOrigin-Name: 0fcc3cbdfa21adf97aed01fa76991cccf9380e2755b0182a9e2c94e3c8fb38d7
---
 ext/fts5/fts5_index.c           |  4 +--
 ext/fts5/test/fts5corrupt8.test | 53 +++++++++++++++++++++++++++++++++
 manifest                        | 16 +++++-----
 manifest.uuid                   |  2 +-
 4 files changed, 64 insertions(+), 11 deletions(-)

--- a/ext/fts5/fts5_index.c
+++ b/ext/fts5/fts5_index.c
@@ -1933,9 +1933,9 @@ static void fts5SegIterSetNext(Fts5Index
 ** leave an error in the Fts5Index object.
 */
 static void fts5SegIterAllocTombstone(Fts5Index *p, Fts5SegIter *pIter){
-  const int nTomb = pIter->pSeg->nPgTombstone;
+  const i64 nTomb = (i64)pIter->pSeg->nPgTombstone;
   if( nTomb>0 ){
-    int nByte = nTomb * sizeof(Fts5Data*) + sizeof(Fts5TombstoneArray);
+    i64 nByte = nTomb * sizeof(Fts5Data*) + sizeof(Fts5TombstoneArray);
     Fts5TombstoneArray *pNew;
     pNew = (Fts5TombstoneArray*)sqlite3Fts5MallocZero(&p->rc, nByte);
     if( pNew ){
